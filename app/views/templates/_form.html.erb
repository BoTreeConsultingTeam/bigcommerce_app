<div class="row">
	<div class="col-lg-12">
		<div class="hpanel">
			<div class="panel-body">
				<%= simple_form_for(@template, html: {class: 'form-horizontal'}) do |f| %>
				<div class="form-group">
					<label class="col-sm-2 control-label">Name*</label>
					<div class="col-sm-10">
						<%= f.input :name, required: true, label: false %>
					</div>
					<div class="clearfix"></div>
					<label class="col-sm-2 control-label">Event*</label>
					<div class="col-sm-10">
						<%= f.input :event_id, collection: Event.pluck(:name, :id), label: false, id: 'event_select', class: 'form-control', include_blank: false%>
					</div>
					<div class="clearfix"></div>
					<label class="col-sm-2 control-label">Event Type*</label>
					<div class="col-sm-10" id="event-type-list">
						<% event = @template.new_record? ? Event.first : @template.event %>
						<% event_type = @template.new_record? ? EventType.first : @event_type%>
						<%= render partial: 'templates/event_types', locals: { event: event, event_type: event_type }%>
					</div>
					<div class="clearfix"></div>
					<label class="col-sm-2 control-label">Available Variables</label>
					<div class="col-sm-10">
						<div class="form-group">
							<%= select_tag 'template[variables]', options_for_select(::Template::AVAILABLE_TEMPLATE_VARIABLES), class: 'form-control select optional' %>
						</div>
					</div>
					<div class="clearfix"></div>
					<label class="col-sm-2 control-label">Subject*</label>
					<div class="col-sm-10">
						<%= f.input :subject, label: false, placeholder: "Write the subject here..."%>
					</div>
					<div class="clearfix"></div>
					<label class="col-sm-2 control-label">Body*</label>
					<div class="col-sm-10">
						<div class="form-group">
							<div id="summernote"><%= @template.body.html_safe if @template.body.present? %></div>
						</div>
						<%= f.input :body, as: :hidden, label: false, required:false %>
					  <div class="has-error"><%= f.error :body%></div>
					</div>
				</div>
          <div class="clearfix"></div>
          <label class="col-sm-2 control-label"></label>
					<div class="col-sm-10">
						<div class="form-action">
							<%= f.button :submit, "Save" %>
							<%= link_to 'Cancel', templates_path, class: 'btn btn-default', method: :get %>
						</div>
					</div>
				<% end %>
			</div>
		</div>
	</div>
</div>
<% if @template.body.present? %>
<div id="default-template-body-order" style="display: none;"><%= @template.body.html_safe%></div>
<div id="default-template-body-shipment" style="display: none;"><%= @template.body.html_safe%></div>
<% else %>
<div id="default-template-body-order" style="display: none;"><%= ::Template::DEFAULT_TEMPLATES[:order][:body].html_safe%></div>
<div id="default-template-body-shipment" style="display: none;"><%= ::Template::DEFAULT_TEMPLATES[:shipment][:body].html_safe%></div>
<% end %>
<script>
$(document).ready(function(){
	$('.note-editable').on('keyup', function() {
		$("#template_body").val($('#summernote').code());
	});
  BigCommerce.Template.NewTemplate();
  BigCommerce.Template.InsertAtCaretPosition();
	 $("#template_event_id option:selected").val();
	$('#template_event_id').on('change', function(){
		if ($("#template_event_type_id option:selected").text() != 'order created') {
			$('#summernote').code($("#default-template-body-order").html());
		} else {
			$('#summernote').code($("#default-template-body-shipment").html());
		}
		var event =	this.options[this.options.selectedIndex].value
		$.ajax({
  		url: "/event_types/list",
  		data: { event: event, template_id: "<%= @template.id %>" }
		})
	});

	$("#template_event_type_id").on('change', function() {
		var selected = $("#template_event_type_id option:selected").text();
		if ($("#template_event_type_id option:selected").text() == 'order created') {
			$('#summernote').code($("#default-template-body-order").html());
		} else {
			$('#summernote').code($("#default-template-body-shipment").html());
		}
	});

});

$(function(){
	$("#new_template").validate({
	    rules: {
	        name: {
	            required: true
	        },
	        event_type_id: {
	        	required: true
	        },
	        body: {
	        	required: true
	        }
	    },
	    submitHandler: function(form) {
	        form.submit();
	    }
	});
});
</script>
